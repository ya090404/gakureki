<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ノベル＋クイズゲーム</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: black;
    }
    #quiz-img, #input-container, #input-container-2, .choice-btn {
      position: absolute;
      z-index: 10;
    }
    #quiz-img {
      left: 50%;
      transform: translateX(-50%);
      max-width: 80%;
      height: auto;
    }
    #input-container, #input-container-2 {
      left: 50%;
      transform: translateX(-50%);
      display: none;
      flex-direction: column;
      align-items: center;
      width: 90%;
    }
    input[type="text"] {
      font-size: 20px;
      padding: 8px;
      width: 60%;
      border: 2px solid #ccc;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    button {
      font-size: 18px;
      padding: 10px 20px;
      border: none;
      background-color: pink;
      color: blue;
      border-radius: 8px;
      margin: 5px;
    }
    .choice-btn {
      width: 40%;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="750" height="1334"></canvas>
  <img id="quiz-img" src="" style="display:none;" />
  <div id="input-container">
    <p style="color: white; font-weight: bold; font-size: 18px; text-shadow: 1px 1px 2px black;">ひらがなで答えてね</p>
    <input type="text" id="answerInput" placeholder="こたえを入力" />
    <button onclick="submitAnswer()">答える</button>
  </div>
  <div id="input-container-2">
    <p style="color: white; font-weight: bold; font-size: 18px; text-shadow: 1px 1px 2px black;">ひらがなで答えてね</p>
    <input type="text" id="answerInput2" placeholder="こたえを入力" />
    <button onclick="submitAnswer2()">答える</button>
  </div>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const images = {
      girl: "girl.PNG",
      boy: "boy.PNG"
    };

    const quizImage = document.getElementById("quiz-img");
    const inputContainer = document.getElementById("input-container");
    const inputContainer2 = document.getElementById("input-container-2");
    const answerInput = document.getElementById("answerInput");
    const answerInput2 = document.getElementById("answerInput2");

    const quizAnswers = [];
    let currentScene = 0;

    const scenes = [
      { image: "girl.PNG", text: "…どうしたの？急に呼び出して", speaker: "西条さん" },
      { image: "boy.PNG", text: "実は…その…伝えたいことがあって！", speaker: "俺" },
      { image: "girl.PNG", text: "えっ、なに？", speaker: "西条さん" },
      { image: "boy.PNG", text: "ずっと…好きでした！俺と、付き合ってください！", speaker: "俺" },
      { image: "girl.PNG", text: "…", speaker: "西条さん" },
      { image: "boy.PNG", text: "(これは…ダメか…！？)", speaker: "俺" },
      { image: "girl.PNG", text: "ありがとう。嬉しいよ。付き合いたい気持ちはあるけど…", speaker: "西条さん" },
      { image: "girl.PNG", text: "私、誰かと付き合う前に、テストをするって決めてるの。", speaker: "西条さん" },
      { image: "boy.PNG", text: "テ………テスト！？", speaker: "俺" },
      { image: "girl.PNG", text: "今から、始めるね。全問正解したら、付き合ってもいいよ。", speaker: "西条さん" },
      { image: "boy.PNG", text: "わ………わかった！！", speaker: "俺" },
      { image: "girl.PNG", text: "日本地図：この県はどこ？", speaker: "西条さん", quiz: true, img: "q1.png", choices: ["徳島県", "香川県", "愛媛県", "高知県"], correct: "高知県" },
      { image: "girl.PNG", text: "これはなんという名前の形？", speaker: "西条さん", quiz: true, img: "q2.png", choices: ["バッグ・クロージャー", "バー・ロジャース", "クロックタッチ", "クロス・バー"], correct: "クロス・バー" },
      { image: "girl.PNG", text: "A〜Dのうち答えの違うものは？\n\nA: He wants to buy __ melon.\nB: She is eating __ apple.\nC: I ate __ banana.\nD: Would you like __ peach?", speaker: "西条さん", quiz: true, choices: ["A", "B", "C", "D"], correct: "B", fontsize: "18px" },
      { image: "girl.PNG", text: "「仙人掌」の読みは？", speaker: "西条さん", quiz: true, input: true, correct: "さぼてん" }
    ];

    function drawScene() {
      const scene = scenes[currentScene];
      const img = new Image();
      img.src = scene.image;
      img.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        if (!scene.quiz) {
          ctx.font = "28px sans-serif";
          ctx.fillStyle = "white";
          ctx.strokeStyle = "black";
          ctx.lineWidth = 3;
          ctx.strokeText(scene.speaker, 100, 1100);
          ctx.fillText(scene.speaker, 100, 1100);

          ctx.font = "26px sans-serif";
          ctx.strokeText(scene.text, 100, 1150);
          ctx.fillText(scene.text, 100, 1150);
        }

        quizImage.style.display = "none";
        inputContainer.style.display = "none";
        inputContainer2.style.display = "none";
        document.querySelectorAll(".choice-btn").forEach(btn => btn.remove());

        if (scene.quiz) {
          if (scene.img) {
            quizImage.src = scene.img;
            quizImage.style.top = "30%";
            quizImage.style.display = "block";
          }

          if (scene.choices) {
            const fontSize = scene.fontsize || "24px";
            const topOffset = currentScene === 12 ? 600 : 1010;

            scene.choices.forEach((choice, index) => {
              const btn = document.createElement("button");
              btn.className = "choice-btn";
              btn.innerText = choice;
              btn.style.top = `${topOffset + Math.floor(index / 2) * 60}px`;
              btn.style.left = `${index % 2 === 0 ? 80 : 400}px`;
              btn.style.position = "absolute";
              btn.style.fontSize = fontSize;
              btn.onclick = () => {
                quizAnswers.push(choice);
                currentScene++;
                drawScene();
              };
              document.body.appendChild(btn);
            });
          }

          if (scene.input) {
            inputContainer2.style.display = "flex";
            answerInput2.value = "";
          }
        }
      };
    }

    canvas.addEventListener("click", () => {
      if (scenes[currentScene] && scenes[currentScene].quiz) return;
      currentScene++;
      drawScene();
    });

    function submitAnswer() {
      const answer = answerInput.value.trim();
      if (answer) {
        quizAnswers.push(answer);
        currentScene++;
        drawScene();
      }
    }

    function submitAnswer2() {
      const answer = answerInput2.value.trim();
      if (answer) {
        quizAnswers.push(answer);
        currentScene++;
        drawScene();
      }
    }

    drawScene();
  </script>
</body>
</html>